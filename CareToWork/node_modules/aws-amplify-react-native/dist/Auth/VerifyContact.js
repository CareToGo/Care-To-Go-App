var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _picker=require("@react-native-picker/picker");var _awsAmplify=require("aws-amplify");var _AmplifyUI=require("../AmplifyUI");var _AuthPiece2=_interopRequireDefault(require("./AuthPiece"));var _AmplifyTestIDs=_interopRequireDefault(require("../AmplifyTestIDs"));var _Utils=require("../Utils");var _jsxFileName="/root/amplify-js/packages/aws-amplify-react-native/src/Auth/VerifyContact.tsx";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var logger=new _awsAmplify.Logger('VerifyContact');var VerifyContact=function(_AuthPiece){(0,_inherits2.default)(VerifyContact,_AuthPiece);var _super=_createSuper(VerifyContact);function VerifyContact(props){var _this;(0,_classCallCheck2.default)(this,VerifyContact);_this=_super.call(this,props);_this._validAuthStates=['verifyContact'];_this.state={verifyAttr:null,error:null};_this.verify=_this.verify.bind((0,_assertThisInitialized2.default)(_this));_this.submit=_this.submit.bind((0,_assertThisInitialized2.default)(_this));return _this;}(0,_createClass2.default)(VerifyContact,[{key:"verify",value:function verify(){var _this2=this;var user=this.props.authData;var attr=this.state.pickAttr;if(!attr){this.error('Neither Email nor Phone Number selected');return;}var that=this;_awsAmplify.Auth.verifyCurrentUserAttribute(attr).then(function(data){logger.debug(data);that.setState({verifyAttr:attr});}).catch(function(err){return _this2.error(err);});}},{key:"submit",value:function submit(){var _this3=this;var attr=this.state.verifyAttr;var code=this.state.code;_awsAmplify.Auth.verifyCurrentUserAttributeSubmit(attr,code).then(function(data){logger.debug(data);_this3.changeState('signedIn',_this3.props.authData);}).catch(function(err){return _this3.error(err);});}},{key:"skip",value:function skip(){this.changeState('signedIn');}},{key:"createPicker",value:function createPicker(unverified){var _this4=this;var email=unverified.email,phone_number=unverified.phone_number;if(email&&phone_number){return _react.default.createElement(_picker.Picker,(0,_extends2.default)({selectedValue:this.state.pickAttr,onValueChange:function onValueChange(value,index){return _this4.setState({pickAttr:value});}},(0,_Utils.setTestId)(_AmplifyTestIDs.default.AUTH.VERIFY_CONTACT_PICKER),{__self:this,__source:{fileName:_jsxFileName,lineNumber:110,columnNumber:5}}),_react.default.createElement(_picker.Picker.Item,{label:_awsAmplify.I18n.get('Email'),value:"email",__self:this,__source:{fileName:_jsxFileName,lineNumber:115,columnNumber:6}}),_react.default.createElement(_picker.Picker.Item,{label:_awsAmplify.I18n.get('Phone Number'),value:"phone_number",__self:this,__source:{fileName:_jsxFileName,lineNumber:116,columnNumber:6}}));}else if(email){return _react.default.createElement(_picker.Picker,(0,_extends2.default)({selectedValue:this.state.pickAttr,onValueChange:function onValueChange(value,index){return _this4.setState({pickAttr:value});}},(0,_Utils.setTestId)(_AmplifyTestIDs.default.AUTH.VERIFY_CONTACT_PICKER),{__self:this,__source:{fileName:_jsxFileName,lineNumber:121,columnNumber:5}}),_react.default.createElement(_picker.Picker.Item,{label:_awsAmplify.I18n.get('Email'),value:"email",__self:this,__source:{fileName:_jsxFileName,lineNumber:126,columnNumber:6}}));}else if(phone_number){return _react.default.createElement(_picker.Picker,(0,_extends2.default)({selectedValue:this.state.pickAttr,onValueChange:function onValueChange(value,index){return _this4.setState({pickAttr:value});}},(0,_Utils.setTestId)(_AmplifyTestIDs.default.AUTH.VERIFY_CONTACT_PICKER),{__self:this,__source:{fileName:_jsxFileName,lineNumber:131,columnNumber:5}}),_react.default.createElement(_picker.Picker.Item,{label:_awsAmplify.I18n.get('Phone Number'),value:"phone_number",__self:this,__source:{fileName:_jsxFileName,lineNumber:136,columnNumber:6}}));}else{return null;}}},{key:"verifyBody",value:function verifyBody(theme){var unverified=this.props.authData.unverified;if(!unverified){logger.debug('no unverified contact');return null;}var email=unverified.email,phone_number=unverified.phone_number;return _react.default.createElement(_reactNative.View,{style:theme.sectionBody,__self:this,__source:{fileName:_jsxFileName,lineNumber:153,columnNumber:4}},this.createPicker(unverified),_react.default.createElement(_AmplifyUI.AmplifyButton,(0,_extends2.default)({theme:theme,text:_awsAmplify.I18n.get('Verify'),onPress:this.verify,disabled:!this.state.pickAttr},(0,_Utils.setTestId)(_AmplifyTestIDs.default.AUTH.VERIFY_BUTTON),{__self:this,__source:{fileName:_jsxFileName,lineNumber:155,columnNumber:5}})));}},{key:"submitBody",value:function submitBody(theme){var _this5=this;return _react.default.createElement(_reactNative.View,{style:theme.sectionBody,__self:this,__source:{fileName:_jsxFileName,lineNumber:168,columnNumber:4}},_react.default.createElement(_AmplifyUI.FormField,(0,_extends2.default)({theme:theme,onChangeText:function onChangeText(text){return _this5.setState({code:text});},label:_awsAmplify.I18n.get('Confirmation Code'),placeholder:_awsAmplify.I18n.get('Enter your confirmation code'),required:true},(0,_Utils.setTestId)(_AmplifyTestIDs.default.AUTH.CONFIRMATION_CODE_INPUT),{__self:this,__source:{fileName:_jsxFileName,lineNumber:169,columnNumber:5}})),_react.default.createElement(_AmplifyUI.AmplifyButton,(0,_extends2.default)({theme:theme,text:_awsAmplify.I18n.get('Submit'),onPress:this.submit,disabled:!this.state.code},(0,_Utils.setTestId)(_AmplifyTestIDs.default.AUTH.SUBMIT_BUTTON),{__self:this,__source:{fileName:_jsxFileName,lineNumber:177,columnNumber:5}})));}},{key:"showComponent",value:function showComponent(theme){var _this6=this;return _react.default.createElement(_AmplifyUI.Wrapper,{__self:this,__source:{fileName:_jsxFileName,lineNumber:190,columnNumber:4}},_react.default.createElement(_reactNative.View,{style:theme.section,__self:this,__source:{fileName:_jsxFileName,lineNumber:191,columnNumber:5}},_react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:192,columnNumber:6}},_react.default.createElement(_AmplifyUI.Header,{theme:theme,testID:_AmplifyTestIDs.default.AUTH.VERIFY_CONTACT_TEXT,__self:this,__source:{fileName:_jsxFileName,lineNumber:193,columnNumber:7}},_awsAmplify.I18n.get('Verify Contact')),!this.state.verifyAttr&&this.verifyBody(theme),this.state.verifyAttr&&this.submitBody(theme),_react.default.createElement(_reactNative.View,{style:theme.sectionFooter,__self:this,__source:{fileName:_jsxFileName,lineNumber:198,columnNumber:7}},_react.default.createElement(_AmplifyUI.LinkCell,{theme:theme,onPress:function onPress(){return _this6.changeState('signedIn');},testID:_AmplifyTestIDs.default.AUTH.SKIP_BUTTON,__self:this,__source:{fileName:_jsxFileName,lineNumber:199,columnNumber:8}},_awsAmplify.I18n.get('Skip'))),_react.default.createElement(_AmplifyUI.ErrorRow,{theme:theme,__self:this,__source:{fileName:_jsxFileName,lineNumber:203,columnNumber:7}},this.state.error)),_react.default.createElement(_AmplifyUI.SignedOutMessage,(0,_extends2.default)({},this.props,{__self:this,__source:{fileName:_jsxFileName,lineNumber:205,columnNumber:6}}))));}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){if(props.authData){var unverified=props.authData.unverified;if(!unverified){logger.debug('no unverified contact');return null;}var email=unverified.email,phone_number=unverified.phone_number;if(email&&!state.pickAttr){return{pickAttr:'email'};}else if(phone_number&&!state.pickAttr){return{pickAttr:'phone_number'};}else{return null;}}else{return null;}}}]);return VerifyContact;}(_AuthPiece2.default);exports.default=VerifyContact;